{% extends "admin/base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã{% endblock %}

{% block admin_content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group me-2">
                <a href="{{ url_for('admin.download_database') }}" class="btn btn-sm btn-outline-success">
                    <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å –ë–î
                </a>
            </div>
        </div>
    </div>

    <form method="POST">
        <div class="row">
            <!-- Price Management -->
            <div class="col-lg-8">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏</h6>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 
                            –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–∫–∞–∑—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å –ø—Ä–µ–∂–Ω–∏–º–∏ —Ü–µ–Ω–∞–º–∏.
                        </div>
                        
                        {% if video_types %}
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>–¢–∏–ø –≤–∏–¥–µ–æ</th>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</th>
                                        <th>–ù–æ–≤–∞—è —Ü–µ–Ω–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for video_type in video_types %}
                                    <tr>
                                        <td>
                                            <strong>{{ video_type.name }}</strong>
                                        </td>
                                        <td>
                                            <small class="text-muted">{{ video_type.description }}</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-success">{{ "%.2f"|format(video_type.price) }} ‚ÇΩ</span>
                                        </td>
                                        <td>
                                            <div class="input-group input-group-sm">
                                                <input type="number" 
                                                       class="form-control" 
                                                       name="price_{{ video_type.id }}" 
                                                       value="{{ "%.2f"|format(video_type.price) }}" 
                                                       step="0.01" 
                                                       min="0">
                                                <span class="input-group-text">‚ÇΩ</span>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> 
                            –¢–∏–ø—ã –≤–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î.
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- System Settings -->
            <div class="col-lg-4">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">üîß –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h6>
                    </div>
                    <div class="card-body">
                        {% if settings %}
                            {% for setting in settings %}
                            <div class="mb-3">
                                <label for="setting_{{ setting.key }}" class="form-label">
                                    {{ setting.name or setting.key }}
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="setting_{{ setting.key }}" 
                                       name="setting_{{ setting.key }}" 
                                       value="{{ setting.value }}">
                                {% if setting.description %}
                                    <div class="form-text">{{ setting.description }}</div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> 
                                –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Database Info -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">üíæ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="mb-2">
                                    <i class="fas fa-users fa-2x text-primary"></i>
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">–ö–ª–∏–µ–Ω—Ç—ã</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        {{ users_count }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="mb-2">
                                    <i class="fas fa-shopping-cart fa-2x text-success"></i>
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">–ó–∞–∫–∞–∑—ã</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        {{ orders_count }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="mb-2">
                                    <i class="fas fa-calendar fa-2x text-info"></i>
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">–¢—É—Ä–Ω–∏—Ä—ã</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        {{ events_count }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="mb-2">
                                    <i class="fas fa-video fa-2x text-warning"></i>
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">–¢–∏–ø—ã –≤–∏–¥–µ–æ</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        {{ video_types_count }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="text-center">
                            <a href="{{ url_for('admin.download_database') }}" 
                               class="btn btn-success btn-sm">
                                <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                            </a>
                            <div class="form-text mt-2">
                                –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Save Button -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-body text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                        <div class="form-text mt-2">
                            –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
// Auto-format price inputs
document.querySelectorAll('input[type="number"]').forEach(input => {
    input.addEventListener('blur', function() {
        if (this.value && !isNaN(this.value)) {
            this.value = parseFloat(this.value).toFixed(2);
        }
    });
});

// Confirmation for save
document.querySelector('form').addEventListener('submit', function(e) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è? –≠—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã.')) {
        e.preventDefault();
    }
});
</script>
{% endblock %}
